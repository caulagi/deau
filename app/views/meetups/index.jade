extends ../layouts/default
include ../includes/mixins

block content
  include ../includes/marketing

  .container#loc-human.hide
    .pull-right Showing events around &nbsp;
      span.cursive.green.info

  .vspace-two
  - if (upcoming.length || past.length)
    .col-sm-9.col-xs-12
      - if (upcoming.length)
        h1 Upcoming events
        +renderMeetups(upcoming)

      - if (past.length)
        hr.vspace-three
        h1 Past events
        +renderMeetups(past)

      - if (pages > 1)
        .pagination
          ul
            != createPagination(pages, page)
    .col-sm-offset-1.col-sm-2.col-xs-12
      include ./browse

  - else
    .vspace-two
    p.muted No events in your city yet.&nbsp;
      a(href="/meetups/new") Create one
    p Or see listing for &nbsp;
      a(href="/meetups/by-city/#{fallbackCityId}") Bangalore


block extra_js
  script.
    mixpanel.track('Event listing (index) page')
  script.
    var geocoder = new google.maps.Geocoder()
    var latlng

    if (#{upcoming.length}) {
      latlng = new google.maps.LatLng(#{upcoming[0].loc.coordinates[0]}, #{upcoming[0].loc.coordinates[1]})
    } else {
      latlng = new google.maps.LatLng(#{past[0].loc.coordinates[0]}, #{past[0].loc.coordinates[1]})
    }

    geocoder.geocode({'latLng': latlng}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        if (results[1]) {
          $("#loc-human .info").text(results[1].formatted_address);
          $("#loc-human").removeClass("hide");
        }
      }
    })
