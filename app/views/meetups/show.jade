extends ../layouts/default

block main
  .row
    h1= meetup.title
      -if (meetup.isFree)
        span.free.label.label-success free
    div#feedback-box.alert.hide(data-dismiss="alert")
    -if (meetup.website)
      p.no-margin
        a(href="#{meetup.website}", target="_blank") #{meetup.website}
    p.no-margin
      | #{meetup.venue}, &nbsp;
    .orange
      = formatDatetime(meetup.startDate)
      | &nbsp;to&nbsp;
      = formatDatetime(meetup.endDate)

  .row.vspace-one
    .social-buttons
      span
        a(href="https://twitter.com/share", data-text="Check out this event - #{meetup.title} - ", data-lang="en").twitter-share-button Tweet
      span
        <iframe src="//www.facebook.com/plugins/like.php?app_id=#{FACEBOOK_APP_ID}&amp;href=http://www.hattira.com/meetups/#{meetup.id}&amp;layout=standard&amp;action=recommend&amp;show_faces=false&amp;share=false" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width: 350px; height: 21px;" allowTransparency="false"></iframe>
      - if (showAttending)
        .pull-right
          form(action="#", id="attending")
            input(type='hidden', name='_csrf', value="#{csrf_token}")
            input(type="hidden", name="meetup_id", value="#{meetup.id}")
            button(type='submit').btn.btn-primary.btn-sm
              span.glyphicon.glyphicon-share
              | &nbsp;I'm attending

block content
  .row.vspace-two
    p !{meetup.description}
    - if (meetup.user)
      - var name = meetup.user.name ? meetup.user.name : meetup.user.username
      p.no-margin
        span.text-muted Created by &nbsp;
        a(href="/users/"+meetup.user._id)= name
        | &nbsp;on&nbsp;
        span.orange #{formatDate(meetup.createdAt)}
      - if (meetup.tags)
        p
          strong Tags: &nbsp;
          - each tag in meetup.tags.split(',')
            | &nbsp;
            a.tag(href="/tags/"+tag)
              span.glyphicon.glyphicon-map-marker
              | &nbsp;#{tag},
      p
        span.text-muted Attending:
        - each attendee in meetup.attending
          a(href="/users/"+attendee.user.id) &nbsp;#{attendee.user.name},

    - if (allowEdit)
      p
        br
        form.center.form-inline.confirm(action="/meetups/"+meetup.id, method="post")
          input(type='hidden', name='_csrf', value="#{csrf_token}")
          a.btn.btn-primary(href='/meetups/'+meetup._id+'/edit', title="edit")
            span.glyphicon.glyphicon-edit
            | &nbsp;Edit
          | &nbsp;&nbsp;
          input(type="hidden", name="_method", value="DELETE")
          button.btn.btn-danger(type="submit")
            span.glyphicon.glyphicon-remove-circle
            | &nbsp;Delete

    #map-canvas.vspace-three
    p.vspace-two
      #disqus_thread

                

block extra_js
  script.
    mixpanel.track('Show event page')
    var address = {
      latitude: #{meetup.loc.coordinates[1]},
      longitude: #{meetup.loc.coordinates[0]},
      venue: "#{meetup.venue}"
    }
    showVenueMap(address)

    var disqus_shortname = 'hattira';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
